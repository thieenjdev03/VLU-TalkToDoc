import pdfMake from 'pdfmake/build/pdfmake'
import pdfFonts from 'pdfmake/build/vfs_fonts'
import { useMemo, useState, useCallback } from 'react'

import {
  Box,
  Grid,
  Table,
  Paper,
  Stack,
  Button,
  TableRow,
  TableBody,
  TableCell,
  TableHead,
  Typography
} from '@mui/material'

import Iconify from 'src/components/iconify'

import { CaseOffer, CaseMedication } from 'src/types/case'

import { renderAge, renderGender } from './utils'

type PrescriptionViewProps = {
  prescriptions: CaseOffer[]
  doctor_name: string
  onOpenPrescriptionModal: () => void
  userProfile: any
  currentCase: any
}

export default function PrescriptionView({
  prescriptions,
  doctor_name,
  onOpenPrescriptionModal,
  userProfile,
  currentCase
}: PrescriptionViewProps) {
  const [showAll, setShowAll] = useState(false)
  const patientInformation = currentCase?.appointmentId?.patient
  console.log('currentCase check', currentCase)
  // Helper tính tổng tiền tạm tính cho 1 đơn - wrap trong useCallback
  const calcTotalPrice = useCallback((meds: CaseMedication[]) => {
    if (!Array.isArray(meds)) return 0
    return meds.reduce((sum, med) => {
      const price = med?.price ?? 0
      const quantity = med?.quantity ?? 1
      return (
        sum +
        (Number.isNaN(price) || Number.isNaN(quantity) ? 0 : price * quantity)
      )
    }, 0)
  }, [])

  // Tính tổng tiền cho tất cả toa thuốc
  const totalAllPrescriptions = useMemo(() => {
    if (!prescriptions?.length) return 0
    return prescriptions.reduce(
      (total, offer) => total + calcTotalPrice(offer.medications),
      0
    )
  }, [prescriptions, calcTotalPrice])

  // Tạo nội dung PDF cho một toa thuốc
  const generatePDFContent = useCallback(
    (offer: CaseOffer, patientInformation: any, index: number) => {
      const totalPrice = calcTotalPrice(offer.medications)
      const currentDate = new Date().toLocaleDateString('vi-VN')

      // Tạo bảng thuốc
      const medicationTableBody: any[][] = [
        [
          { text: 'STT', bold: true, alignment: 'center' },
          { text: 'Tên thuốc', bold: true, alignment: 'center' },
          { text: 'Số lượng', bold: true, alignment: 'center' },
          { text: 'Liều lượng', bold: true, alignment: 'center' },
          { text: 'Cách dùng', bold: true, alignment: 'center' },
          { text: 'Thời gian', bold: true, alignment: 'center' },
          { text: 'Giá (VNĐ)', bold: true, alignment: 'center' }
        ]
      ]

      if (offer.medications?.length) {
        offer.medications.forEach((med, medIdx) => {
          medicationTableBody.push([
            { text: (medIdx + 1).toString(), alignment: 'center' },
            { text: med.name || 'Không tên thuốc', fontSize: 10 },
            { text: (med.quantity || 1).toString(), alignment: 'center' },
            { text: med.dosage || '-', fontSize: 10 },
            { text: med.usage || '-', fontSize: 10 },
            { text: med.duration || '-', fontSize: 10 },
            {
              text: med.price
                ? `${(med.price * 1000).toLocaleString('vi-VN')}`
                : '0',
              alignment: 'right'
            }
          ])
        })
      } else {
        medicationTableBody.push([
          {
            text: 'Không có thuốc nào trong đơn này',
            colSpan: 7,
            alignment: 'center',
            fontSize: 10
          }
        ])
      }

      return {
        header() {
          return {
            image:
              'data:image/png;base64,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',
            width: 200,
            opacity: 0.5,
            alignment: 'center',
            marginBottom: 20
          }
        },
        watermark: {
          text: 'TalkToDoc - Platform',
          color: '#2065D1',
          opacity: 0.1,
          bold: true,
          italics: false
        },
        content: [
          // Header
          {
            columns: [
              {
                text: 'TalkToDoc Platform – Nền tảng tư vấn y tế thông minh',
                bold: true,
                fontSize: 12,
                width: '*'
              },
              {
                text: `Mã đơn: ${offer._id || 'N/A'}`,
                fontSize: 10,
                alignment: 'right',
                width: 'auto'
              },
              {
                text: `Mã Bệnh Án: ${currentCase?.caseId || 'N/A'}`,
                fontSize: 10,
                alignment: 'right',
                width: 'auto'
              }
            ],
            margin: [10, 0, 0, 10]
          },

          // Title
          {
            text: `ĐƠN THUỐC ${prescriptions.length > 1 ? `#${index + 1}` : ''}`,
            alignment: 'center',
            fontSize: 16,
            bold: true,
            margin: [0, 10, 0, 20]
          },

          // Patient info placeholder (có thể thay thế bằng thông tin thật nếu có)
          {
            columns: [
              {
                text: `Họ tên: ${patientInformation?.fullName || '_______________________'}`,
                fontSize: 12
              },
              {
                text: `Giới tính: ${renderGender(patientInformation?.gender.toUpperCase()) || '____'} Tuổi: ${renderAge(patientInformation?.birthDate) || '____'}`,
                fontSize: 12
              }
            ],
            margin: [0, 0, 0, 5]
          },

          {
            text: `Địa chỉ: ${offer.shippingAddress || '_______________________'}`,
            fontSize: 12,
            margin: [0, 0, 0, 5]
          },

          {
            text: `Số điện thoại: ${offer.shippingPhone || '_______________________'}`,
            fontSize: 12,
            margin: [0, 0, 0, 5]
          },

          {
            text: `Chẩn đoán: ${currentCase?.medicalForm?.diagnosis || '_______________________'}`,
            fontSize: 12,
            margin: [0, 0, 0, 15]
          },

          // Medication table
          {
            table: {
              headerRows: 1,
              widths: ['auto', '*', 'auto', 'auto', 'auto', 'auto', 'auto'],
              body: medicationTableBody
            },
            layout: 'lightHorizontalLines',
            margin: [0, 0, 0, 15]
          },

          // Total price
          {
            text: `Tổng tiền tạm tính: ${(totalPrice * 1000).toLocaleString('vi-VN')} VNĐ`,
            fontSize: 12,
            bold: true,
            alignment: 'right',
            margin: [0, 10, 0, 15]
          },

          // Notes
          offer.note
            ? {
                text: `Lời dặn: ${offer.note}`,
                fontSize: 12,
                margin: [0, 0, 0, 10]
              }
            : {
                text: 'Lời dặn: Dùng đúng liều, không bỏ thuốc giữa chừng.',
                fontSize: 12,
                margin: [0, 0, 0, 10]
              },

          // Date and signature
          {
            text: `Ngày kê: ${offer.createdAt ? new Date(offer.createdAt).toLocaleDateString('vi-VN') : currentDate}`,
            fontSize: 12,
            margin: [0, 10, 0, 20]
          },

          {
            columns: [
              { text: '', width: '*' },
              {
                stack: [
                  {
                    text: 'Bác sĩ điều trị',
                    alignment: 'center',
                    fontSize: 12
                  },
                  { text: '\n\n', alignment: 'center' },
                  {
                    text: `(${doctor_name || 'Ký tên'})`,
                    alignment: 'center',
                    fontSize: 11
                  }
                ],
                width: 'auto'
              }
            ]
          },

          // Pharmacy info if available
          ...(offer.pharmacyId?.name
            ? [
                {
                  text: `Nhà thuốc: ${offer.pharmacyId.name}`,
                  fontSize: 10,
                  alignment: 'center',
                  margin: [0, 20, 0, 0]
                }
              ]
            : []),
          {
            text: 'Quét mã QR để xem hồ sơ điện tử:',
            fontSize: 12,
            margin: [0, 20, 0, 5]
          },
          {
            qr: `https://dashboard.talktodoc.online/dashboard/case/${currentCase?._id}`,
            fit: 100, // hoặc fit: [width, height]
            alignment: 'center',
            foreground: '#000000' // màu QR
          }
        ],
        pageSize: 'A4',
        pageMargins: [40, 60, 40, 60]
      }
    },
    [calcTotalPrice, doctor_name, prescriptions.length]
  )

  // Export một toa thuốc ra PDF sử dụng dynamic import
  const exportSinglePrescriptionToPDF = useCallback(
    async (offer: CaseOffer, patientInformation: any, index: number) => {
      try {
        // Setup fonts
        pdfMake.vfs = pdfFonts?.pdfMake?.vfs // ✅ Đúng cách gán vfs

        const docDefinition = generatePDFContent(
          offer,
          patientInformation,
          index
        ) as any
        const fileName = `toa-thuoc-${offer._id || `${Date.now()}`}.pdf`

        pdfMake.createPdf(docDefinition).download(fileName)
      } catch (error) {
        console.error('Error generating PDF:', error)
        alert('Có lỗi xảy ra khi xuất PDF. Vui lòng thử lại!')
      }
    },
    [generatePDFContent]
  )

  // Export tất cả toa thuốc ra một file PDF
  const exportAllPrescriptionsToPDF = useCallback(async () => {
    if (!prescriptions?.length) return

    try {
      const pdfMake = await import('pdfmake/build/pdfmake')
      const pdfFonts = await import('pdfmake/build/vfs_fonts')

      // Setup fonts
      pdfMake.default.vfs = (pdfFonts as any).default.pdfMake.vfs

      const allContent: any[] = []

      prescriptions.forEach((offer, index) => {
        const prescriptionContent = generatePDFContent(offer, index)
        allContent.push(...prescriptionContent.content)

        // Thêm page break nếu không phải là toa cuối cùng
        if (index < prescriptions.length - 1) {
          allContent.push({ text: '', pageBreak: 'before' })
        }
      })

      // Thêm trang tổng hợp ở đầu
      const summaryContent = [
        {
          text: 'TỔNG HỢP TOA THUỐC',
          alignment: 'center',
          fontSize: 18,
          bold: true,
          margin: [0, 20, 0, 30]
        },
        {
          columns: [
            {
              text: `Tổng số toa thuốc: ${prescriptions.length}`,
              fontSize: 14,
              bold: true
            },
            {
              text: `Tổng tiền: ${(totalAllPrescriptions * 1000).toLocaleString('vi-VN')} VNĐ`,
              fontSize: 14,
              bold: true,
              alignment: 'right'
            }
          ],
          margin: [0, 0, 0, 20]
        },
        {
          text: `Bác sĩ kê đơn: ${doctor_name}`,
          fontSize: 12,
          margin: [0, 0, 0, 10]
        },
        {
          text: `Ngày xuất: ${new Date().toLocaleDateString('vi-VN')}`,
          fontSize: 12,
          margin: [0, 0, 0, 30]
        },
        { text: '', pageBreak: 'before' }
      ]

      const docDefinition = {
        content: [...summaryContent, ...allContent],
        pageSize: 'A4',
        pageMargins: [40, 60, 40, 60]
      }

      const fileName = `tong-hop-toa-thuoc-${Date.now()}.pdf`
      pdfMake.default.createPdf(docDefinition as any).download(fileName)
    } catch (error) {
      console.error('Error generating PDF:', error)
      alert('Có lỗi xảy ra khi xuất PDF. Vui lòng thử lại!')
    }
  }, [prescriptions, generatePDFContent, totalAllPrescriptions, doctor_name])

  if (!prescriptions?.length) {
    return (
      <Paper elevation={3} sx={{ p: 3 }}>
        <Stack
          direction="row"
          spacing={1}
          alignItems="center"
          justifyContent="space-between"
        >
          <Typography variant="h6" gutterBottom>
            Toa thuốc
          </Typography>
          <Stack direction="row" spacing={2}>
            <Button
              variant="contained"
              color="primary"
              onClick={onOpenPrescriptionModal}
              hidden={userProfile?.role === 'PATIENT'}
            >
              <Iconify icon="eva:file-text-fill" sx={{ mr: 1 }} />
              Kê toa thuốc
            </Button>
            <Button
              variant="outlined"
              color="success"
              onClick={exportAllPrescriptionsToPDF}
              disabled
            >
              <Iconify icon="solar:download-bold" sx={{ mr: 1 }} />
              Xuất file PDF
            </Button>
          </Stack>
        </Stack>

        <Typography variant="body2">Chưa có toa thuốc nào</Typography>
      </Paper>
    )
  }

  const visiblePrescriptions = showAll
    ? prescriptions
    : prescriptions.slice(0, 1)

  return (
    <>
      <Typography variant="h6" gutterBottom>
        Tổng hợp toa thuốc
      </Typography>
      <Grid container spacing={2} sx={{ mt: 1 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Paper elevation={2} sx={{ p: 2, height: '100%' }}>
            <Typography variant="subtitle2" color="text.secondary">
              Tổng số toa thuốc
            </Typography>
            <Typography variant="h4" color="primary" sx={{ mt: 1 }}>
              {prescriptions.length}
            </Typography>
          </Paper>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Paper elevation={2} sx={{ p: 2, height: '100%' }}>
            <Typography variant="subtitle2" color="text.secondary">
              Tổng tiền các toa thuốc
            </Typography>
            <Typography variant="h4" color="primary" sx={{ mt: 1 }}>
              {(totalAllPrescriptions * 1000).toLocaleString('vi-VN')} đ
            </Typography>
          </Paper>
        </Grid>
      </Grid>

      {/* Button xuất tất cả toa thuốc */}
      <Box sx={{ mb: 3, mt: 2 }}>
        <Button
          variant="contained"
          color="success"
          onClick={exportAllPrescriptionsToPDF}
          startIcon={<Iconify icon="solar:download-bold" />}
          size="large"
        >
          Xuất tất cả toa thuốc (PDF)
        </Button>
      </Box>

      {visiblePrescriptions.map((offer, idx) => {
        const totalPrice = calcTotalPrice(offer.medications)
        return (
          <Paper key={offer._id || idx} elevation={3} sx={{ p: 3, mb: 3 }}>
            <Stack
              direction="row"
              spacing={1}
              alignItems="center"
              justifyContent="space-between"
            >
              <Typography variant="h6" gutterBottom>
                Toa thuốc {prescriptions.length > 1 ? `#${idx + 1}` : ''}
              </Typography>
              <Stack direction="row" spacing={2}>
                <Button
                  variant="contained"
                  color="primary"
                  onClick={onOpenPrescriptionModal}
                  hidden={userProfile?.role === 'PATIENT'}
                >
                  <Iconify icon="eva:file-text-fill" sx={{ mr: 1 }} />
                  Kê toa thuốc
                </Button>
                <Button
                  variant="outlined"
                  color="success"
                  onClick={() =>
                    exportSinglePrescriptionToPDF(
                      offer,
                      patientInformation,
                      idx
                    )
                  }
                >
                  <Iconify icon="solar:download-bold" sx={{ mr: 1 }} />
                  Xuất PDF
                </Button>
              </Stack>
            </Stack>

            <Typography variant="body2" sx={{ mb: 1 }}>
              Mã đơn: <strong>{offer._id}</strong>
            </Typography>
            <Typography variant="body2" sx={{ mb: 1 }}>
              Bác sĩ kê đơn: <strong>{doctor_name}</strong>
            </Typography>
            <Typography variant="body2" sx={{ mb: 1 }}>
              Địa chỉ: <strong>{offer.shippingAddress || 'Chưa có'}</strong>
            </Typography>
            <Typography variant="body2" sx={{ mb: 1 }}>
              Số điện thoại: <strong>{offer.shippingPhone || 'Chưa có'}</strong>
            </Typography>
            <Typography variant="body2" sx={{ mb: 1 }}>
              Nhà thuốc: <strong>{offer.pharmacyId?.name || '-'}</strong>
            </Typography>
            <Typography variant="body2" sx={{ mb: 2 }}>
              Ngày kê:{' '}
              <strong>
                {offer.createdAt
                  ? new Date(offer.createdAt).toLocaleDateString('vi-VN')
                  : '-'}
              </strong>
            </Typography>

            <Table size="small">
              <TableHead>
                <TableRow>
                  <TableCell>Tên thuốc</TableCell>
                  <TableCell>Số lượng</TableCell>
                  <TableCell>Liều lượng</TableCell>
                  <TableCell>Cách dùng</TableCell>
                  <TableCell>Thời gian</TableCell>
                  <TableCell>Giá thuốc</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {offer.medications?.length ? (
                  offer.medications.map((med, medIdx) => (
                    <TableRow key={med._id || medIdx}>
                      <TableCell>{med.name || 'Không tên thuốc'}</TableCell>
                      <TableCell>{med.quantity || 1}</TableCell>
                      <TableCell>{med.dosage}</TableCell>
                      <TableCell>{med.usage}</TableCell>
                      <TableCell>{med.duration}</TableCell>
                      <TableCell>
                        {med.price
                          ? `${(med.price * 1000).toLocaleString('vi-VN')} đ`
                          : ''}
                      </TableCell>
                    </TableRow>
                  ))
                ) : (
                  <TableRow>
                    <TableCell colSpan={6} align="center">
                      Không có thuốc nào trong đơn này
                    </TableCell>
                  </TableRow>
                )}
              </TableBody>
            </Table>

            <Box mt={2}>
              <Typography variant="subtitle1" color="primary">
                Tạm tính tổng: {(totalPrice * 1000).toLocaleString('vi-VN')} đ
              </Typography>
            </Box>

            {offer.note && (
              <Box mt={2}>
                <Typography variant="subtitle2">Ghi chú:</Typography>
                <Typography variant="body2">{offer.note}</Typography>
              </Box>
            )}
          </Paper>
        )
      })}

      {prescriptions.length > 1 && (
        <Box textAlign="center">
          <Button onClick={() => setShowAll(!showAll)}>
            {showAll
              ? 'Ẩn bớt toa thuốc'
              : `Xem thêm ${prescriptions.length - 1} đơn`}
          </Button>
        </Box>
      )}
    </>
  )
}
